<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.pro.myrp.persistence.purchase.purchaseDAO">
 	
 	 <!-- 구매내역 총 개수 -->
 	<select id="select_purchase_cnt" resultType="int">
 		<![CDATA[
 		SELECT	COUNT(*)
 		FROM	purchase_ORDER
 		]]>
 	</select>
 	
 	<!-- 구매내역 목록 -->
 	<select id="select_purchase_list" parameterType="java.util.Map"
 	resultType="PurchaseVO">
 		<![CDATA[
	   SELECT  *
		FROM    ( SELECT PURCHASE_ID, ACCOUNT_ID, ORDER_ID, PRODUCT_ID, 
                    COMPANY_ID, EMPLOYEE_ID, REG_DATE, UPDATE_DATE, 
                    STORAGE_IN_DATE, COUNT_PURCHASE, SUPPLY_PRICE, 
                    PURCHASE_STATE, CONDITION_NOTE_PAYABLE, COMPANY_NAME ,rownum rNum
 
		        FROM    (SELECT  P.PURCHASE_ID, P.ACCOUNT_ID, P.ORDER_ID, P.PRODUCT_ID, 
                            P.COMPANY_ID, P.EMPLOYEE_ID, P.REG_DATE, P.UPDATE_DATE, 
                            P.STORAGE_IN_DATE, P.COUNT_PURCHASE, P.SUPPLY_PRICE, 
                            P.PURCHASE_STATE, P.CONDITION_NOTE_PAYABLE, C.COMPANY_NAME
				
		                FROM    PURCHASE_ORDER P , COMPANY C
                    WHERE   P.COMPANY_ID = C.COMPANY_ID
		                ORDER BY PURCHASE_ID
		                )
		        )
		WHERE rNum >= #{start} AND rNUM <= #{end}
 		]]>
 	</select>
 	
 	<!-- 구매내역 자세히 보기 -->
 	<select id="select_detail_purchase" parameterType="String"
 	resultType="PurchaseVO">
 		<![CDATA[
		SELECT  * 
	    FROM   ( SELECT  P.PURCHASE_ID, P.ACCOUNT_ID, P.ORDER_ID, P.PRODUCT_ID, 
                            P.COMPANY_ID, P.EMPLOYEE_ID, P.REG_DATE, P.UPDATE_DATE, 
                            P.STORAGE_IN_DATE, P.COUNT_PURCHASE, P.SUPPLY_PRICE, 
                            P.PURCHASE_STATE, P.CONDITION_NOTE_PAYABLE, C.COMPANY_NAME
			     FROM    PURCHASE_ORDER P , COMPANY C
	             WHERE   P.COMPANY_ID = C.COMPANY_ID )
		WHERE 	COMPANY_ID = #{company_id}
 		]]>
 	</select>
 	
 	
 	
 	<!-- 구매 정보 수정 -->
 	<update id="update_purchase" parameterType="PurchaseVO">
 		<![CDATA[
		UPDATE	PURCHASE_ORDER 
		SET		PURCHASE_ID = #{purchase_id}, ACCOUNT_ID = #{account_id}, ORDER_ID = #{order_id},
				PRODUCT_ID = #{product_id}, EMPLOYEE_ID = #{employee_id}, REG_DATE = #{reg_date}, 
				UPDATE_DATE = #{update_date}, STORAGE_IN_DATE = #{storage_in_date},
				COUNT_PURCHASE = #{count_purchase}, SUPPLY_PRICE = #{supply_price}, 
				PURCHASE_STATE = #{purchase_state}, CONDITION_NOTE_PAYABLE = #{condition_note_payable}
		WHERE	COMPANY_ID = #{company_id}
 		]]>
 	</update>
 	
 	
 	
 	<!-- 구매 바로 검색 개수 -->
 	<select id="count_quick_serch_purchase" parameterType="String"
 	resultType="int">
 		<![CDATA[
		SELECT  COUNT(P.PURCHASE_ID) 
	    FROM	PURCHASE_ORDER P
	    JOIN	COMPANY C
	    ON		P.COMPANY_ID = C.COMPANY_ID
		WHERE 	C.COMPANY_NAME LIKE '%'||#{search_str}||'%'
 		]]>
 	</select>
 	
 	
 	<!-- 구매 바로 검색 -->
 	<select id="select_quick_serch_purchase" parameterType="java.util.Map"
 	resultType="PurchaseVO">
 		<![CDATA[
 		SELECT  * 
		FROM (	SELECT   P.PURCHASE_ID, P.ACCOUNT_ID, P.ORDER_ID, P.PRODUCT_ID, 
		                 P.COMPANY_ID, P.EMPLOYEE_ID, P.REG_DATE, P.UPDATE_DATE, 
		                 P.STORAGE_IN_DATE, P.COUNT_PURCHASE, P.SUPPLY_PRICE, 
		                 P.PURCHASE_STATE, P.CONDITION_NOTE_PAYABLE, C.COMPANY_NAME, rownum rNum
			    FROM	PURCHASE_ORDER P
			    JOIN	COMPANY C
			    ON		P.COMPANY_ID = C.COMPANY_ID
				WHERE 	C.COMPANY_NAME LIKE '%'||#{search_str}||'%' )
		WHERE rNum >= #{start} AND rNUM <= #{end}
		ORDER BY PURCHASE_ID
		
 		]]>
 	</select>
 	
 	
 	
 	<!-- 상품 테이블 목록 불러오기 -->
 	<select id="select_product_ids" resultType="PurchaseVO">
 		SELECT PRODUCT_ID, PRODUCT_NAME
		FROM PRODUCT
 	</select>
 	
 	<!-- 거래처 테이블 목록 불러오기 -->
 	<select id="select_company_ids" resultType="PurchaseVO">
 		SELECT COMPANY_ID, COMPANY_NAME
		FROM COMPANY
 	</select>
 	
 	<!-- 사원 테이블 목록 불러오기 -->
 	<select id="select_employee_ids" resultType="PurchaseVO">
 		SELECT EMPLOYEE_ID, EMPLOYEE_NAME
		FROM EMPLOYEE
 	</select>
 	
 	<!-- 오더 테이블 목록 불러오기 -->
 	<select id="select_order_ids" resultType="PurchaseVO">
 		SELECT ACCOUNT_ID
		FROM ACCOUNT
 	</select>
 	
 	<insert id="insert_reg_purchase" parameterType="PurchaseVO">
 		INSERT INTO PURCHASE_ORDER
			  (PURCHASE_ID, ACCOUNT_ID,
			  PRODUCT_ID, COMPANY_ID, EMPLOYEE_ID,
			  REG_DATE, UPDATE_DATE,  STORAGE_IN_DATE,
			  COUNT_PURCHASE, SUPPLY_PRICE, PURCHASE_STATE,
			  CONDITION_NOTE_PAYABLE)
		VALUES 
			  ( PURCHASE_SEQ.NEXTVAL, #{account_id},
			  #{product_id}, #{company_id}, #{employee_id},
			  #{reg_date}, SYSDATE, #{storage_in_date},
			  #{count_purchase}, #{supply_price}, 25451, #{condition_note_payable}
			  )
 	
 	</insert>
 	
 	
 	
 	
</mapper>
